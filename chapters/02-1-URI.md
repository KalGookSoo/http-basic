# Chapter 02 URI와 웹 브라우저 요청 흐름

## 02-1 URI

### 개요
이 섹션에서는 URI(Uniform Resource Identifier)의 개념과 구성 요소를 학습합니다. URI/URL/URN의 차이, 스키마/호스트/포트/경로/쿼리/프래그먼트 등 구조, 예약 문자와 퍼센트 인코딩 규칙, 경로와 쿼리의 책임 분리를 실무 예시와 함께 다룹니다. 또한 브라우저와 서버가 URI를 어떻게 해석하는지 시퀀스 다이어그램으로 살펴봅니다.

학습 목표
- URI, URL, URN의 정의와 차이를 설명할 수 있다.
- URI의 구성 요소(스키마, 사용자정보, 호스트, 포트, 경로, 쿼리, 프래그먼트)를 구분할 수 있다.
- 예약 문자와 퍼센트 인코딩의 필요성과 규칙을 이해하고 예시로 설명할 수 있다.
- 경로와 쿼리 설계의 모범 사례를 말할 수 있다.

### URI, URL, URN의 차이
- URI: 리소스를 식별하는 모든 식별자(상위 개념). URL과 URN을 포함.
- URL(Locator): 리소스의 위치를 나타내는 식별자. 예: `https://example.com/images/cat.png`
- URN(Name): 위치와 무관한 이름 기반 식별자. 예: `urn:isbn:9780316066525`

```mermaid
flowchart LR
    URI[URI] --> URL[URL]
    URI --> URN[URN]
    URL -->|예: https| HTTPS
    URL -->|예: http| HTTP
    URN -->|예: ISBN| ISBN
```

### URI의 구성 요소
일반 형태(가변 요소 포함):

```
scheme://[userinfo@]host[:port][/path][?query][#fragment]
```

예시:
- `https://user:pass@www.example.com:443/products/123?ref=ad&lang=ko#reviews`

```mermaid
flowchart TB
    S[scheme=https] --> U[userinfo=user:pass]
    U --> H[host=www.example.com]
    H --> P[port=443]
    P --> Path[path=/products/123]
    Path --> Q[query=ref=ad&lang=ko]
    Q --> F[fragment=reviews]
```

구성 요소 설명
- 스키마(scheme): 프로토콜 또는 접근 방식. 예: `http`, `https`, `ftp`, `mailto` 등
- 사용자정보(userinfo): `user:password@` 형식. 보안/로그 기록 문제로 웹에서는 사용 비권장
- 호스트(host): 도메인 또는 IP. 예: `example.com`, `93.184.216.34`
- 포트(port): 생략 시 스키마 기본 포트 사용(HTTP 80, HTTPS 443 등)
- 경로(path): 리소스의 계층적 위치. 예: `/articles/2025/uri`
- 쿼리(query): 비계층적 파라미터. `key=value` 쌍을 `&`로 연결. 예: `?page=2&sort=desc`
- 프래그먼트(fragment): 문서 내 위치 식별(클라이언트 전용, 서버로 전송되지 않음). 예: `#section-2`

### 예약 문자와 퍼센트 인코딩
URI는 ASCII 기반이며, 특정 문자는 특별한 의미가 있어 예약(reserved)되어 있습니다. 안전하지 않은 문자를 포함해야 하는 경우 퍼센트 인코딩(percent-encoding)을 사용합니다.

- 예약 문자 예: `: / ? # [ ] @ ! $ & ' ( ) * + , ; =`
- 공백, 한글, 이모지 등 비 ASCII 문자는 인코딩 필요
- 퍼센트 인코딩: 바이트 값을 `%HH`(16진수)로 표현
  - 예: 공백(space) → `%20`, `+`는 쿼리 컨텍스트에서 공백으로 해석될 수 있음에 유의

컨텍스트별 인코딩 규칙
- 경로 세그먼트: `/`는 계층 구분자이므로 인코딩하지 않음(의도적 문자로 쓰려면 `%2F`)
- 쿼리 문자열: `&`와 `=`는 파라미터 구분자이므로 값에 포함 시 인코딩 필요
- 프래그먼트: 브라우저가 해석하며 서버로 전송되지 않음

IDN(Internationalized Domain Name)
- 호스트에 한글/비ASCII 도메인을 사용할 때는 Punycode로 변환
- 예: `도메인.한국` → `xn--o39a12a.xn--3e0b707e`

```mermaid
sequenceDiagram
    autonumber
    participant B as 브라우저
    participant S as 서버
    B->>B: URI 구성요소별 인코딩/정규화
    B->>S: GET /search?q=%ED%95%9C%EA%B8%80 HTTP/1.1
    S-->>B: 200 OK (서버는 디코딩 후 처리)
```

### 경로 vs 쿼리 설계 가이드
- 리소스 식별 자체는 경로에, 필터링/페이지네이션/정렬 같은 옵션은 쿼리에
  - 예: `/products/123` (식별) vs `/products?category=book&sort=price`
- 컬렉션에는 복수형 경로, 개체에는 식별자 사용: `/users`와 `/users/42`
- 상태를 나타내는 서버 동작은 HTTP 메서드로 표현하고 URI는 명사형 유지
  - 나쁨: `POST /users/42/activate`
  - 권장: `POST /users/42/actions:activate` 또는 상태 전이 표현은 PATCH
- 안정적인 경로 설계: 버전은 접두사로 명확히(`/v1/orders`), 포맷 협상은 헤더 사용 선호

### 절대/상대/기저(base) URI
- 절대 URI: 스키마를 포함한 전체 주소. 예: `https://example.com/path`
- 네트워크 경로 참조: `//example.com/path` (스키마 생략, 현재 스키마 따름)
- 절대 경로 참조: `/images/logo.png` (호스트 기준 루트)
- 상대 경로 참조: `../up/one` (기저 URI를 기준으로 해석)

```mermaid
flowchart LR
    Base[Base: example.com/app]
    A[Abs path: /users]
    B[Relative: ../assets/icon.svg]
    C[Network-path: //cdn.example.com/lib.js]
    Base --> A
    Base --> B
    Base --> C
```

### 정규화와 동등성
- 대소문자: 스키마/호스트는 대소문자 구분 없음(`HTTP://EXAMPLE.COM` == `http://example.com`), 경로는 서버에 따라 구분될 수 있음
- 불필요한 포트 제거: `:80`(HTTP), `:443`(HTTPS)
- `.`/`..` 세그먼트 제거, 중복 슬래시 축약
- 쿼리 파라미터 순서는 의미가 같아도 문자열 비교 시 달라질 수 있음 → 정렬 규칙 정의 필요

### 6가지 키워드로 정리하는 핵심 포인트
1. **식별자**: URI는 리소스를 식별하는 표준 표기이며 URL과 URN을 포괄한다.
2. **구성요소**: scheme, userinfo, host, port, path, query, fragment로 이뤄진다.
3. **인코딩**: 예약 문자/비ASCII는 퍼센트 인코딩, 컨텍스트별 규칙을 따른다.
4. **IDN**: 비ASCII 도메인은 Punycode로 변환되어 전송된다.
5. **설계원칙**: 식별은 경로, 옵션은 쿼리. 동작은 메서드로 표현한다.
6. **정규화**: 대소문자/포트/세그먼트/쿼리 정렬 등으로 동등성 판단을 돕는다.

### 확인 문제
1. 다음 중 URI의 구성 요소에 대한 설명으로 옳은 것은?
    - [ ] 프래그먼트는 서버가 라우팅을 위해 사용하는 부분이다
    - [ ] 사용자정보는 웹에서 보안상 권장되며 자주 사용된다
    - [ ] 스키마와 호스트는 대소문자를 구분하지 않는다
    - [ ] 쿼리 문자열의 `&`와 `=`는 값 안에 등장해도 인코딩할 필요가 없다

2. 다음 중 퍼센트 인코딩과 관련하여 옳은 것은?
    - [ ] 공백은 항상 `+`로만 인코딩해야 한다
    - [ ] `/` 문자는 경로 구분자이므로 값으로 쓰려면 `%2F`로 인코딩해야 한다
    - [ ] 한글은 ASCII이므로 인코딩이 필요 없다
    - [ ] 프래그먼트는 서버로 전송되므로 반드시 디코딩해서 보관해야 한다

3. 다음 중 옳은 것을 모두 고르시오. (복수 응답)
    - [ ] URL은 URI의 부분집합이다
    - [ ] URN은 리소스 위치가 바뀌어도 동일 식별자로 쓸 수 있다
    - [ ] 경로는 리소스 식별, 쿼리는 필터/정렬/페이징 등 옵션에 적합하다
    - [ ] HTTPS의 기본 포트는 80이다
    - [ ] 호스트에 한글 도메인을 사용할 때 내부적으로 Punycode가 사용될 수 있다

> [정답 및 해설 보기](../answers_and_explanations.md#ans-02-1-uri)
